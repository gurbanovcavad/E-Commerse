{% extends 'auctions/layout.html' %}

{% block body %}
<div class="single-listing-container">
    <h1 class="single-listing-title">{{ listing.title }}</h1>

    {% if is_watching %}
    <a href="{% url 'remove_watching' listing.id %}" class="watchlist-btn watching">Watchlist</a>
    {% else %}
    <a href="{% url 'add_watching' listing.id %}" class="watchlist-btn">Add to Watchlist</a>
    {% endif %}

    <div class="single-listing-image">
        <img src="{{ listing.image_url }}" alt="{{ listing.title }}">
    </div>

    <p class="single-listing-description">{{ listing.description }}</p>
    <div class="single-listing-price">${{ listing.current_price }}</div>

    {% if request.user.is_authenticated and listing.is_active and request.user != listing.owner %}
    <p class="bids-info">{{ count }} bid(s) so far. Your bid is the current bid.</p>
    <form action="{% url 'place_bid' listing.id %}" method="post" class="bid-form">
        {% csrf_token %}
        <input type="text" name="bid" placeholder="Enter your bid">
        <button type="submit">Place Bid</button>
    </form>
    {% elif not listing.is_active %}
        {% if request.user.id == listing.winner.id %}
        <div class="auction-message success">You won this auction.</div>
        {% else %}
        <div class="auction-message ended">The auction is no longer active.</div>
        {% endif %}
    {% endif %}

    <div class="listing-details-box">
        <h3>Details:</h3>
        <ul>
            <li>Listed by {{ listing.owner }}</li>
            {% if listing.category %}
            <li>Category: {{ listing.category }}</li>
            {% else %}
            <li>Category: No Category Listed</li>
            {% endif %}
        </ul>
    </div>

    <div class="comments-section">
        <h3>Comments</h3>
        {% for comment in comments %}
        <div class="comment">
            <div class="comment-meta">{{ comment.author }} commented on {{ comment.timestamp }}</div>
            <div class="comment-content">{{ comment.content }}</div>
        </div>
        {% empty %}
        <div class="no-comments">No comment yet.</div>
        {% endfor %}

        {% if request.user.is_authenticated %}
        <form action="{% url 'add_comment' %}" method="post" class="comment-form">
            {% csrf_token %}
            <input type="hidden" name="listing" value="{{ listing.id }}">
            <input type="text" name="content" placeholder="Add a comment">
            <button type="submit">Submit</button>
        </form>
        {% endif %}
    </div>
</div>
{% endblock %}
